{% extends "base.html" %}
{% block title %}{{ paper.title }}{% endblock %}
{% block content %}
    <div class="paper-detail">
        <h2>{{ paper.title }}</h2>
        <p>{{ paper.summary }}</p>
        <p>Authors: {{ paper.authors }}</p>
        <p>Publication Date: {{ paper.publication_date }}</p>
        <p>URL: <a href="{{ paper.url }}">{{ paper.url }}</a></p>
        {% if paper.authors == user.username %}
            <button>Edit</button>
        {% endif %}
        <div class="reviews">
            <h3>Reviews:</h3>
            {% for post in posts %}
                <div class="review-box">
                    {% if post.paper_id == paper.__oid__ %}
                    <p><strong>{{ post.users_id }}</strong> rated {{ post.score }} / 5</p>
                    <div class="stars">
                        {% for i in range(1, 6) %}
                            {% if post.score >= i %}
                                <span class="star">&#9733;</span>
                            {% elif post.score >= i - 0.5 %}
                                <span class="star">&#9733;</span>
                            {% else %}
                                <span class="star">&#9734;</span>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <p>{{ post.content }}</p>
                    <p><small>{{ post.timestamp }}</small></p>
                </div>
                <hr>
                {% endif %}
            {% endfor %}
        </div>
        {% if not user_has_reviewed %}
        <div class="add-review">
            <h3>Add a Review:</h3>
            <form method="POST" action="{{ url_for('add_post', paper_id=paper.__oid__) }}">
                <textarea name="content" required></textarea>
                <br>
                <label for="score">Score (0-5):</label>
                <input type="number" id="score" name="score" min="0" max="5" step="0.1" required>
                <br>
                <button type="submit">Submit</button>
            </form>
        </div>
        {% endif %}
    </div>
{% endblock %}
